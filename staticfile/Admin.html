<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title></title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel="shortcut icon" href="./resource/images/favicon.ico" />
	<link href="./css/bootstrap.min.css" rel="stylesheet">
	<link href="./css/common.css" rel="stylesheet">
      	<link rel="stylesheet" href="jquerytc/css/demo.css">
  	<link rel="stylesheet" href="jquerytc/src/css/dialog.css">
	<script type="text/javascript" src="./resource/js/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="./resource/js/app/util.js?v=20170915"></script>
    <script type="text/javascript" src="js/umit.js"></script>
    <script src="jquerytc/js/jquery.min.js"></script>
    <script src="jquerytc/src/jquery.dialog.js"></script>
</head>
<body>
	<div class="loader" style="display:none">
		<div class="la-ball-clip-rotate">
			<div></div>
		</div>
	</div>
<div data-skin="default" class="skin-default  main-lg-body ">
<div class="head">
	<nav class="navbar navbar-default" role="navigation">
		<div class="container ">
			<div class="navbar-header">
				<a class="navbar-brand" href="http://jiadll8.zhaojingl.com/">
					<span class="version hidden">1.6.2</span>
				</a>
			</div>
						<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-left">
															<li><a href="/index.html" >首页</a></li>

									</ul>

			</div>
					</div>
	</nav>
</div>

<div class="main">
<div class="container">
	<a href="javascript:" class="js-big-main button-to-big color-gray" title="加宽">正常</a>
		<div class="panel panel-content main-panel-content ">
			<div class="content-head panel-heading main-panel-heading">
				<img src="/images/icon.jpg" class="head-app-logo" onerror="this.src=''">
				<span class="font-lg">钻石投票</span>

				<div class="pull-right related-info module-related-info">
				</div>

				<!-- 兼容历史性问题：模块内获取不到模块信息$module的问题-start -->
				<!-- end -->					</div>
	<div class="panel-body clearfix main-panel-body ">
		<div class="left-menu">
						<div class="left-menu-content">
																<div class="panel panel-menu">
										<ul class="list-group">
									 <li class="list-group-item ">
										<a href="/Admin.html" class="text-over" >
                                            <i class='wi wi-reply'></i> 个人中心</a>
									</li>
                                    <li class="list-group-item ">
										<a href="#" class="text-over" >
                                            <i class='wi wi-reply'></i> 自动调票</a>
									</li>

                                            <li class="list-group-item ">
										<a href="/auto_click.html" class="text-over" >
                                            <i class='fa fa-cog'></i> 自动点击	</a>
									</li>
																																			</ul>
				</div>
																				<div class="panel panel-menu">
										<div class="panel-heading">
						<span class="no-collapse">业务菜单<i class="wi wi-appsetting pull-right setting"></i></span>
					</div>
										<ul class="list-group">
																																						<li class="list-group-item ">
										<a href="/index.html" class="text-over" >
																				<i class='wi wi-appsetting'></i> 活动管理										</a>
									</li>
																																																														<li class="list-group-item ">
										<a href="/backlist.html" class="text-over" >
																				<i class='wi wi-appsetting'></i> 黑名单										</a>
									</li>
																																			</ul>
				</div>
											</div>
					</div>
		<div class="right-content">
	<style>
.thumbnail img{min-width: 20px;min-height: 20px;}
.main_form .we7-form input[type=radio], .main_form .we7-form input[type=checkbox] {
    display: inline-block;
    cursor: pointer;
}
.btn-downpic{
}
 .we7-form input[type=radio],  .we7-form input[type=checkbox] {
    display: inline-block;
    cursor: pointer;
}
</style>
<div class="we7-page-title"></div>
<ul class="we7-page-tab">
	<li class="active"><a href="#" id="add" >个人中心</a></li>
</ul>
<div class="we7-form">
	<div class="form-group">
		<label class="control-label col-sm-4 control-label" id="name">用户名:WWWW</label>
        	<label class="control-label col-sm-2 control-label" id="money">总额:WWWW</label>
        <a class="btn btn-primary" id="confirmWithCustom">修改密码</a>
	</div>

     <div class="form-group">
		<label class="control-label col-sm-2 control-label">视频文件</label>
          <span class="control-label col-sm-1 control-label" id="videoname">没有视频</span>
         <div class="col-sm-8 col-xs-12">
                        <button  class="btn btn-primary" id="videoupdate">修改</button>
                        <a class="btn btn-primary" href="#" id="videopath">查看</a>
						<a class="btn btn-primary" href="#" id="videodelete">删除</a>
                        <input  style="display:none"  id="files" type="file">
					</div>
	</div>
</div>

			</div>
		</div>
	</div>
</div>
</div>
	<div class="container-fluid footer text-center" role="footer">
		<div class="friend-link">
								</div>
		<div class="copyright"></div>
	</div>

		</div>
</body>

<script>
 $(document).ready(function () {

     get_admininfp()
     $("#videoupdate").click(function () {

          $("#files").click()
     })
     $("#files").change(filse_change)
 })


    function get_admininfp() {
        var data={"action":'get_info'}
         $.ajax({
             url: '/user',
             type: 'POST',
             data: data,
             success: function (arg) {
                 arg = JSON.parse(arg);
                if (arg["code"]==0)
                {
                  var data=arg["data"]
                    $("#name").text("用户名："+data["usname"])
                    $("#money").text("总金额："+data["money"])
                    if(data["videoname"]=="")
                    {
                        $("#videoname").text("没有视频")
                    }
                    else {
                        $("#videoname").text(data["videoname"])
                    }
                     $("#videopath").attr("href",data["videourl"])
                }
                else{

                }

             }
         })

    }
      $('#confirmWithCustom').click(function() {
      $.sendConfirm({
        title: '修改密码',
        content: '<div id="addIpBox">' + '<div class="frm-item">' + '<div class="frm-label"><span class="requireIcon">*</span> 原密码:</div>' + '<input type="text" class="frm-input" id="oldpswd" placeholder="">' + '<div class="msg-box j_msgIp hide"></div>' + '</div>' + '<div class="frm-item">' + '<div class="frm-label"><span class="requireIcon">*</span> 重复原密码:</div>' + '<input type="text" class="frm-input" id="newpswd1" placeholder="">' + '<div class="msg-box j_msgDesc hide"></div>' + '</div>' + '<div class="frm-item">' + '<div class="frm-label"><span class="requireIcon">*</span> 新密码:</div>' + '<input type="text" class="frm-input" id="newpswd" placeholder="">' + '<div class="msg-box j_msgOperator hide"></div>' + '</div>' + '</div>',
        button: {
          confirm: '确认',
          cancel: '取消'
        },
        width: 260,
        onBeforeConfirm: function() {

             var oldpswd=$("#oldpswd").val()
        var newpsdw1=$("#newpswd1").val()
        var newpswd=$("#newpswd").val()

              console.log(newpsdw1)
              console.log(newpswd)
            if(newpsdw1!=newpswd){
               $.sendWarningToTop('两次密码不一致', 3000, function() {
                   console.log('sendWarningToTop closed');
               })
                return false
         }

            var data={"oldpswd":oldpswd,"newpswd":newpswd,"action":"update_pswd"}

      $.sendWarningToTop('上传中，勿随意点击', 10000, function() {
        console.log('sendWarningToTop closed');
      });
  
            $.ajax({
                url:"/user",
                  type: 'POST',
                 data: data,
                 success: function (arg)
                 {
                     arg = JSON.parse(arg);
                if (arg["code"]==0){


                       $.sendSuccessToTop('修改成功,3秒后返回登录界面', 3000, function() {
                     location.href="login.html"
                     });
                }
                else
                {
                        $.sendWarningToTop('密码错误', 3000, function() {
                   console.log('sendWarningToTop closed');
               })
                }
                 }
                }
            )
          // onBeforeConfirm返回false，将阻止onConfirm的执行
          return true;
        },
        onConfirm: function() {


        },
        onCancel: function() {
          console.log('点击取消！');
        },
        onClose: function() {
          console.log('点击关闭！');
        }
      });
    });
 function filse_change() {
     var fiel= $(this).prop('files');
     var this_=this;
     console.log(fiel[0]);
        if((fiel[0].size/1024/1024)>500)
            {
                alert("文件过大");
            }
            filepath=fiel[0].name;
            var extStart=filepath.lastIndexOf(".");
            var ext=filepath.substring(extStart,filepath.length).toUpperCase();
            if(ext!=".MP4")
            {

                alert("限于MP4格式");
                return
            }
             var formFile = new FormData();
               formFile.append("video", fiel[0]); //加入文件对象
       $.ajax({
        url:'/user?action=upload_video',
        type: 'POST',
        data:formFile,
        processData: false,//用于对data参数进行序列化处理 这里必须false
        contentType: false, //必须
        success: function (arg)
        {
            arg=JSON.parse(arg);

            if(arg["code"]=="0")
            {
               get_admininfp()
                var data=arg["data"];
                 $.sendSuccessToTop('修改成功', 3000, function() {
                 console.log('sendSuccessToTop closed');
             });
            }
        }
    });

}
</script>
</html>